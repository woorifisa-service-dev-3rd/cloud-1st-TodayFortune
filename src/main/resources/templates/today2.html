<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TTS 플레이어</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.3.4/axios.min.js"></script>
</head>
<body>
<h1>TTS 플레이어</h1>
<p id="fortune2">운세를 가져오는 중...</p>
<audio id="audioPlayer" controls style="display: none;"></audio>

<script>
    window.onload = async function() {
        try {
            const response = await axios.get('/api/fortune2');
            const fortuneText = response.data;

            document.getElementById('fortune2').innerText = fortuneText;

            // TTS 요청 및 음성 재생
            await convertAndPlay(fortuneText);
        } catch (error) {
            console.error('운세 가져오기 오류:', error);
            document.getElementById('fortune2').innerText = '운세를 가져오는 데 실패했습니다.';
        }
    };

    async function convertAndPlay(text) {
        const audioPlayer = document.getElementById('audioPlayer');

        try {
            // 서버에 TTS 요청
            const response = await axios.get('/test', {
                params: { text: text },
                responseType: 'blob'  // 바이너리 데이터로 응답 받기
            });

            // Blob URL 생성
            const audioBlob = new Blob([response.data], { type: 'audio/mp3' });
            const audioUrl = URL.createObjectURL(audioBlob);

            // 오디오 플레이어 설정 및 재생
            audioPlayer.src = audioUrl;
            audioPlayer.style.display = 'block';
            audioPlayer.play();
        } catch (error) {
            console.error('오디오 변환 중 오류 발생:', error);
            alert('오디오 변환 중 오류가 발생했습니다.');
        }
    }
</script>
</body>
</html>